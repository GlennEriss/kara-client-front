@startuml RechercherDemandes
title Workflow : Rechercher des Demandes (V2)

start

:Admin accède à la liste des demandes;

:Afficher champ de recherche :
- Input avec placeholder "Rechercher par nom, prénom..."
- Debounce 300ms;

:Admin commence à taper dans le champ;

:Debounce 300ms :
- Attendre que l'utilisateur arrête de taper;

if (Query >= 2 caractères ?) then (oui)
  :Normaliser la query :
  - toLowerCase()
  - trim();
  
  :Vérifier cache recherche :
  - useDemandSearch(normalizedQuery, filters)
  - Cache 2 min;
  
  if (Cache recherche présent et frais ?) then (oui)
    :Afficher résultats depuis cache IMMÉDIATEMENT;
    :Pas de requête serveur;
  else (non)
    :Afficher loading state;
    
    :Repository.search(query, filters) :
    - Firestore where('memberLastName', '>=', query)
    - where('memberLastName', '<=', query + '\uf8ff')
    - orderBy('memberLastName', 'asc')
    - limit(50);
    
    :Filtrer aussi par prénom côté client :
    - matchesFirstName = firstName.includes(query)
    - matchesLastName = lastName.includes(query);
    
    :Mettre en cache (2 min) :
    - Clé : ['demand-search', normalizedQuery, filters];
    
    :Afficher résultats;
  endif
  
  if (Résultats trouvés ?) then (oui)
    :Afficher liste filtrée :
    - Grid ou Table selon vue
    - Highlight des termes recherchés;
  else (non)
    :Afficher "Aucun résultat pour 'query'";
  endif
else (non)
  :Afficher liste complète (non filtrée);
endif

if (Admin modifie la recherche ?) then (oui)
  :Nouveau debounce 300ms;
  :Répéter le processus;
endif

if (Admin efface la recherche ?) then (oui)
  :Afficher liste complète;
  :Nettoyer cache recherche (optionnel);
endif

if (Admin applique filtres en plus de recherche ?) then (oui)
  :Combiner recherche + filtres :
  - Appliquer filtres sur résultats recherche
  - OU refaire recherche avec filtres;
endif

note right
  **Fonctionnalités clés** :
  - Debounce 300ms pour éviter trop de requêtes
  - Normalisation query (lowercase, trim)
  - Cache 2 min (recherches fréquentes réutilisées)
  - Recherche par préfixe Firestore
  - Filtrage prénom côté client
  - Limite 50 résultats
  - Highlight termes recherchés
  - Combinaison recherche + filtres
end note

@enduml
